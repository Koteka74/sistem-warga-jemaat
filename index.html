<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login Jemaat</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

  <div class="max-w-md mx-auto mt-20 bg-white p-6 rounded shadow">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhX9jX67zIfE0cZLQFf-NrGmiaHKzcSowRWKhSf8Q1ZmMCz7LPICneJpxotKpNUp6UlZIcvI5IisGEY7e_LrYE0IEctWPjzd5G-n8oEFtziafLuqLWiqXgbDA4_mcyUG_JQHae8VWbfpaLqJoSzB5cRFCiOUni5zs90jL2wCCELiNDe5s0H1EQ5k3I2B_g/s1600/Logo_GKITP.png" alt="Logo GKI" class="w-20 h-20 mx-auto mb-4">
    <h1 class="text-2xl font-bold text-blue-700 mb-1">Database Jemaat</h1>
    <h2 class="text-sm font-semibold text-gray-600 mb-6">GKI Diaspora Kotaraja</h2>

    <form id="loginForm">
    <label class="block mb-2 font-medium">Pilih Peran</label>
    <select name="role" id="role" class="w-full mb-4 p-2 border rounded" required>
      <option value="">-- Pilih Peran --</option>
      <option value="admin">Admin</option>
      <option value="rayon">Majelis Rayon</option>
      <option value="jemaat">Jemaat</option>
    </select>

    <div id="rayonGroup">
      <label class="block mb-2 font-medium">Pilih Rayon</label>
      <select name="rayon" id="rayon" class="w-full mb-4 p-2 border rounded">
        <option value="">-- Pilih Rayon --</option>
        <option value="Rayon I">Rayon I</option>
        <option value="Rayon II">Rayon II</option>
        <option value="Rayon III">Rayon III</option>
        <option value="Rayon IV">Rayon IV</option>
        <option value="Rayon V">Rayon V</option>
        <option value="Rayon VI">Rayon VI</option>
      </select>
    </div>

    <div id="namaGroup">
      <label class="block mb-2 font-medium">Nama (khusus Jemaat)</label>
      <input type="text" name="nama" id="nama" class="w-full mb-4 p-2 border rounded" placeholder="Isi nama Anda jika login sebagai jemaat">
    </div>

    <div id="adminLoginGroup" style="display: none;">
      <label class="block mb-2 font-medium">Username</label>
      <input type="text" id="adminUsername" name="adminUsername" class="w-full mb-4 p-2 border rounded">
      <label class="block mb-2 font-medium">Password</label>
      <input type="password" id="adminPassword" name="adminPassword" class="w-full mb-4 p-2 border rounded">
    </div>

    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">Login</button>
  </form>



  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const roleSelect = document.getElementById("role");
    const rayonGroup = document.getElementById("rayonGroup");
    const namaGroup = document.getElementById("namaGroup");
    const adminLoginGroup = document.getElementById("adminLoginGroup");

    roleSelect.addEventListener("change", () => {
      const role = roleSelect.value;
      if (role === "admin") {
        rayonGroup.style.display = "none";
        namaGroup.style.display = "none";
        adminLoginGroup.style.display = "block";
      } else {
        rayonGroup.style.display = "block";
        namaGroup.style.display = role === "jemaat" ? "block" : "none";
        adminLoginGroup.style.display = "none";
      }
    });

    document.getElementById("loginForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const role = roleSelect.value;

      if (!role) return alert("Silakan pilih peran.");

      if (role === "admin") {
        const username = document.getElementById("adminUsername").value.trim();
        const password = document.getElementById("adminPassword").value.trim();
        if (!username || !password) return alert("Isi username dan password.");

        try {
          const res = await fetch('/api/loginAdmin', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
          });

          const result = await res.json();
          if (result.success) {
            localStorage.setItem("loginData", JSON.stringify({ role: "admin", username }));
            window.location.href = "dashboard.html";
          } else {
            alert("Login admin gagal: " + result.message);
          }
        } catch (err) {
          alert("Gagal terhubung ke server.");
        }
      } else {
        const rayon = document.getElementById("rayon").value;
        const nama = document.getElementById("nama").value.trim();

        if (role === "rayon" && !rayon) return alert("Silakan pilih rayon.");
        if (role === "jemaat" && (!rayon || !nama)) return alert("Isi nama dan pilih rayon.");

        localStorage.setItem("loginData", JSON.stringify({ role, rayon, nama }));
        window.location.href = "dashboard.html";
      }
    });
  });
  </script>
</body>
